{
  "$schema": "https://di.schema.mediact.com/register.prototype.json",
  "type": "list-transformer",
  "identifier": "getting-item-id-from-exact",
  "name": "Exact - Order - Getting Item Id from Exact",
  "description": "Alumiuo Order to Exact restructure",
  "object": {
    "prototype": "chain",
    "parameters": {
      "transformers": [
        {
          "prototype": "node",
          "parameters": {
            "accessor": {
              "prototype": "pattern",
              "parameters": {
                "pattern": "request.SalesOrderLines.*"
              }
            },
            "nodeTransformers": [
              {
                "prototype": "merger",
                "parameters": {
                  "template": {
                    "code": "&{@}"
                  },
                  "transformer": {
                    "prototype": "http-transformer",
                    "parameters": {
                      "client": "%{client}",
                      "request": {
                        "uri": "/&{division}/logistics/Items?$select=ID,Description,Code&$filter=startswith(Code, '&{Item}') eq true",
                        "method": "get",
                        "payload": "&{@}"
                      }
                    }
                  }
                }
              },
              {
                "prototype": "pattern-move",
                "parameters": {
                  "pattern": "code.d.results.0.ID",
                  "replacement": "Item"
                }
              },
              {
                "prototype": "key-filter",
                "parameters": {
                  "accessor": {
                    "prototype": "key",
                    "parameters": {
                      "keys": [
                        "@type",
                        "orderedItem",
                        "orderQuantity",
                        "code",
                        "division"
                      ]
                    }
                  }
                }
              }
            ]
          }
        }
      ]
    }
  },
  "schema": {
    "properties": {
      "client": {
        "title": "HTTP Client",
        "ui": {
          "di:type": "http-client",
          "ui:placeholder": "Default client"
        }
      }
    },
    "required": [
      "client"
    ]
  }
}