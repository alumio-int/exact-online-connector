{
  "$schema": "https://di.schema.mediact.com/register.prototype.json",
  "type": "list-transformer",
  "identifier": "alumio-order-restructure-to-exact",
  "name": "Exact - Order - Alumio order to Exact",
  "description": "Alumio Order to Exact restructure",
  "object": {
    "prototype": "chain",
    "parameters": {
      "transformers": [
        {
          "prototype": "data",
          "parameters": {
            "transformers": [
              {
                "prototype": "list-mapper",
                "parameters": {
                  "mappers": [
                    {
                      "prototype": "list-inherit-from",
                      "parameters": {
                        "array": {
                          "request": {
                            "OrderDate": "&{orderDate.dateCreated}",
                            "OrderedBy": "&{accountDataID}",
                            "SalesOrderLines": "&{orderedItem}"
                          }
                        }
                      }
                    }
                  ],
                  "accessor": {
                    "prototype": "key",
                    "parameters": []
                  }
                }
              },
              {
                "prototype": "value-mapper",
                "parameters": {
                  "mappers": [
                    {
                      "prototype": "format-date",
                      "parameters": {
                        "toFormat": "Y-m-d"
                      }
                    }
                  ],
                  "accessor": {
                    "prototype": "pattern",
                    "parameters": {
                      "pattern": "request.OrderDate"
                    }
                  }
                }
              },
              {
                "prototype": "accessor-copy",
                "parameters": {
                  "source": {
                    "prototype": "key",
                    "parameters": {
                      "keys": [
                        "division"
                      ]
                    }
                  },
                  "destination": {
                    "prototype": "children",
                    "parameters": {
                      "pattern": "request.SalesOrderLines.*",
                      "accessor": {
                        "prototype": "key",
                        "parameters": []
                      }
                    }
                  },
                  "stripEnclosures": true
                }
              }
            ]
          }
        },
        {
          "prototype": "node",
          "parameters": {
            "accessor": {
              "prototype": "pattern",
              "parameters": {
                "pattern": "request.SalesOrderLines.*"
              }
            },
            "nodeTransformers": [
              {
                "prototype": "list-mapper",
                "parameters": {
                  "mappers": [
                    {
                      "prototype": "list-inherit-from",
                      "parameters": {
                        "array": {
                          "Item": "&{orderedItem.sku}",
                          "Quantity": "&{orderQuantity}",
                          "UnitPrice": "&{orderedItem.offers.price}",
                          "Description": "&{orderedItem.name}"
                        }
                      }
                    }
                  ],
                  "accessor": {
                    "prototype": "key",
                    "parameters": []
                  }
                }
              }
            ]
          }
        }
      ]
    }
  }
}